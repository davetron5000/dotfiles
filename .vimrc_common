" To use this, you may define the global variable "g:project_root" to be the
" location of the root of your project. 
set nocompatible

" Needed on some linux distros.
" " see http://www.adamlowe.me/2009/12/vim-destroys-all-other-rails-editors.html
filetype off

" Config for XML editing plugin
let xml_use_xhtml = 1
let xml_no_auto_nesting = 0
let xml_tag_completion_map = ">"

" Misc stuff
hi Normal guibg=black
hi Normal guifg=white
filetype plugin on
filetype indent on
syn on


"""" Configuration
" Check for local .vimrc
set exrc
set noequalalways
set formatoptions-=t formatoptions+=croqn2
set ai
set expandtab
set ts=2
set sw=2
set cindent
set wm=1
set vb t_vb=
set noincsearch
set nohlsearch
if has("nvim")
  set inccommand=
  set nohidden
endif

" Does vim help for any "K", as opposed to going to man page
set keywordprg=
set wildmenu
set undofile
set undodir=~/.vim/undo
augroup vimrc
  autocmd BufWritePre /tmp/* setlocal noundofile
augroup END

if ! exists("g:project_root")
  let g:project_root=getcwd()
endif

" If we are in a 'project', set up a few convieniences, such as searching
" and CtrlP to know about the current project dir
if exists("g:project_root")
  exec "map g :grep -R " . g:project_root . "<Home><Right><Right><Right><Right><Right><Right>"
  exec "map  :grep -R <cword> " . g:project_root
  exec "map G :grep -R <cword> " . g:project_root . ""
  exec "map o :CtrlP " . g:project_root . ""
  exec "map  :CtrlP " . g:project_root . ""
  exec "set path+=" . fnameescape(g:project_root) . "/**"
  exec "set wildignore=*/.git*,*/tmp/**,*/spec/vcr-cassettes/**,*/node_modules/**,*/coverage/**,*/vendor/**"

  " If we are in Rails-land, set up some mappings to run tests
  if exists(":Rake")
    map m :Rake
    map  :.Rake
  endif

  " If we find a spellfile, set up for 'writing' mode
  if filereadable("spellfile.en.utf-8.add")
    set spell spelllang=en_us
    syn spell toplevel
    ab taht that
    ab builting built-in
    ab builtin built-in
    ab endpoing endpoint
    ab tradeoff trade-off
    ab tradeoffs trade-offs
    set complete+=kspell
    exec "set spf=" . g:project_root . "/spellfile.en.utf-8.add"
  else
    " Remove dot from valid file name chars so gf works with method calls on classes
    " For whatever reason this breaks spellfile loading in MacVim
    set isfname-=.
  endif
else
  exec "map g :grep -R  "
  exec "map  :grep -R <cword> "
  exec "map G :grep -R <cword> "
  " Remove dot from valid file name chars so gf works with method calls on classes
  " For whatever reason this breaks spellfile loading in MacVim
  set isfname-=.
endif

" cd to directory of current file
map c :cd %:p:h
" open buffer list
map b \bs
" next error
map   :cnext
" fold this line
map f !!fold -w77 -s 
" ^O tries to open the thing under the cursor using gf
map  sgf
" Avoid annoying ^Z minimizing to nowhere
map  
" Ruby specific, but handy - depends on rails.vim existing.
map m :Rake
map  :.Rake

map : :Tabularize /: /r0c0l0
map = :Tabularize /=
map > :Tabularize /=>

nnoremap <silent> <Leader>t :CtrlP<CR>
nnoremap <silent> <Leader>b :CtrlPBuffer<CR>

au BufEnter *.pml runtime syntax/xml.vim
au BufEnter *.pml runtime indent/xml.vim
colorscheme solarized
set background=dark
set backspace=indent,eol,start
let g:bufExplorerFindActive=0 " Do not go to active window when opening the bufexplorer.

autocmd BufNewFile,BufRead *.asciidoc set ft=asciidoc
autocmd BufNewFile,BufRead Procfile set ft=ruby

let g:syntastic_check_on_open=1
let g:syntastic_quiet_messages = {'level': 'warnings'}
let g:syntastic_always_populate_loc_list=1
let g:syntastic_auto_loc_list=1
let g:syntastic_ignore_files=['Procfile','.css','.css.scss','.py']
let g:syntastic_haml_haml_exe = "LC_ALL=en_US.UTF-8 haml" " computering

let g:ruby_indent_access_modifier_style = 'outdent'
let g:ruby_indent_block_style = 'do'
let ruby_spellcheck_strings = 1

let g:terraform_fmt_on_save=1
let g:terraform_align=1

let g:netrw_keepdir=0

let g:ctrlp_show_hidden=1

autocmd BufNewFile,BufRead *.rb map K :Dash
autocmd BufNewFile,BufRead *.js map K :Dash
autocmd BufNewFile,BufRead *.jsx map K :Dash
autocmd BufNewFile,BufRead *.html map K :Dash
autocmd BufNewFile,BufRead *.erb map K :Dash
autocmd BufNewFile,BufRead *.css map K :Dash
autocmd BufNewFile,BufRead *.scss map K :Dash

autocmd GUIEnter * let g:syntastic_error_symbol='âœ–'

highlight ExtraWhitespace ctermbg=red guibg=red
autocmd Syntax * syn match ExtraWhitespace /\s\+$\| \+\ze\t/
packadd! matchit

if g:gui_vimr == 1
  "set gfn=Source\ Code\ Pro:h18
  set gfn=Monaspace\ Krytpon\ Var:h18
  noremap <S-D-}> :tabnext
  noremap <S-D-{> :tabprevious
endif
let g:copilot_filetypes = { 'pml': v:false, 'markdown': v:false, 'txt': v:false, 'terraform': v:false }
